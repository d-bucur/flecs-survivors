global using PackingData = System.Collections.Generic.Dictionary<string, System.Collections.Generic.Dictionary<string, flecs_test.SpriteSheet.KeyframeRaw[]>>;

using System.Text.Json;
using Raylib_cs;

namespace flecs_test;

// TODO super ugly. Refactor. Load from file
struct SpriteSheet {
	public static PackingData? LoadSheet(string fileName) {
		JsonSerializerOptions options = new();
		options.UnmappedMemberHandling = System.Text.Json.Serialization.JsonUnmappedMemberHandling.Disallow;
		if (fileName == "Content/sprites/Blue_witch/packed/blue_witch.png")
			return JsonSerializer.Deserialize<PackingData>(witchJson, options)!;
		else if (fileName == "Content/sprites/packed2/characters.png")
			return JsonSerializer.Deserialize<PackingData>(charactersJson, options)!;
		else
			return null;
		// TODO Would be better to parse here directly into Rectangles and delete the implicit conversion
	}

	public record struct KeyframeRaw(int x, int y, int w, int h) {
		public static implicit operator Rectangle(KeyframeRaw k) {
			return new Rectangle(k.x, k.y, k.w, k.h);
		}
	}

	static string charactersJson =
	@"
	{
    ""wetland_boss"": {
        ""walk"": [
            {
                ""x"": 0,
                ""y"": 0,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 272,
                ""y"": 0,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 544,
                ""y"": 0,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 816,
                ""y"": 0,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 1088,
                ""y"": 0,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 1360,
                ""y"": 0,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 1632,
                ""y"": 0,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 0,
                ""y"": 112,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 272,
                ""y"": 112,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 544,
                ""y"": 112,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 816,
                ""y"": 112,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 1360,
                ""y"": 0,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 816,
                ""y"": 112,
                ""w"": 272,
                ""h"": 112
            },
            {
                ""x"": 816,
                ""y"": 112,
                ""w"": 272,
                ""h"": 112
            }
        ]
    },
    ""evil_wizard"": {
        ""walk"": [
            {
                ""x"": 1904,
                ""y"": 0,
                ""w"": 140,
                ""h"": 140
            },
            {
                ""x"": 1088,
                ""y"": 112,
                ""w"": 140,
                ""h"": 140
            },
            {
                ""x"": 1228,
                ""y"": 112,
                ""w"": 140,
                ""h"": 140
            },
            {
                ""x"": 1368,
                ""y"": 112,
                ""w"": 140,
                ""h"": 140
            },
            {
                ""x"": 1508,
                ""y"": 112,
                ""w"": 140,
                ""h"": 140
            },
            {
                ""x"": 1648,
                ""y"": 112,
                ""w"": 140,
                ""h"": 140
            },
            {
                ""x"": 1900,
                ""y"": 140,
                ""w"": 140,
                ""h"": 140
            },
            {
                ""x"": 1900,
                ""y"": 280,
                ""w"": 140,
                ""h"": 140
            }
        ]
    },
    ""dead"": {
        ""idle"": [
            {
                ""x"": 1788,
                ""y"": 112,
                ""w"": 80,
                ""h"": 80
            },
            {
                ""x"": 1788,
                ""y"": 192,
                ""w"": 80,
                ""h"": 80
            },
            {
                ""x"": 1088,
                ""y"": 252,
                ""w"": 80,
                ""h"": 80
            },
            {
                ""x"": 1168,
                ""y"": 252,
                ""w"": 80,
                ""h"": 80
            },
            {
                ""x"": 1248,
                ""y"": 252,
                ""w"": 80,
                ""h"": 80
            },
            {
                ""x"": 1328,
                ""y"": 252,
                ""w"": 80,
                ""h"": 80
            },
            {
                ""x"": 1408,
                ""y"": 252,
                ""w"": 80,
                ""h"": 80
            },
            {
                ""x"": 1488,
                ""y"": 252,
                ""w"": 80,
                ""h"": 80
            }
        ]
    },
    ""frost_curse"": {
        ""run"": [
            {
                ""x"": 1868,
                ""y"": 112,
                ""w"": 32,
                ""h"": 64
            },
            {
                ""x"": 1868,
                ""y"": 176,
                ""w"": 32,
                ""h"": 64
            },
            {
                ""x"": 1868,
                ""y"": 240,
                ""w"": 32,
                ""h"": 64
            },
            {
                ""x"": 1920,
                ""y"": 484,
                ""w"": 32,
                ""h"": 64
            }
        ]
    },
    ""dusk_druid"": {
        ""walk"": [
            {
                ""x"": 0,
                ""y"": 224,
                ""w"": 128,
                ""h"": 128
            },
            {
                ""x"": 128,
                ""y"": 224,
                ""w"": 128,
                ""h"": 128
            },
            {
                ""x"": 256,
                ""y"": 224,
                ""w"": 128,
                ""h"": 128
            },
            {
                ""x"": 384,
                ""y"": 224,
                ""w"": 128,
                ""h"": 128
            },
            {
                ""x"": 512,
                ""y"": 224,
                ""w"": 128,
                ""h"": 128
            },
            {
                ""x"": 640,
                ""y"": 224,
                ""w"": 128,
                ""h"": 128
            },
            {
                ""x"": 768,
                ""y"": 224,
                ""w"": 128,
                ""h"": 128
            },
            {
                ""x"": 896,
                ""y"": 224,
                ""w"": 128,
                ""h"": 128
            }
        ]
    },
    ""knight1"": {
        ""run"": [
            {
                ""x"": 1024,
                ""y"": 224,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1024,
                ""y"": 288,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1568,
                ""y"": 252,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1632,
                ""y"": 252,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1696,
                ""y"": 252,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1760,
                ""y"": 272,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1824,
                ""y"": 304,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1760,
                ""y"": 336,
                ""w"": 64,
                ""h"": 64
            }
        ]
    },
    ""sword"": {
        ""walk"": [
            {
                ""x"": 1760,
                ""y"": 400,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1760,
                ""y"": 464,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1824,
                ""y"": 368,
                ""w"": 64,
                ""h"": 64
            },
            {
                ""x"": 1888,
                ""y"": 420,
                ""w"": 64,
                ""h"": 64
            }
        ]
    },
    ""Blue_witch"": {
        ""charge"": [
            {
                ""x"": 1824,
                ""y"": 432,
                ""w"": 48,
                ""h"": 48
            },
            {
                ""x"": 1824,
                ""y"": 480,
                ""w"": 48,
                ""h"": 48
            },
            {
                ""x"": 1952,
                ""y"": 420,
                ""w"": 48,
                ""h"": 48
            },
            {
                ""x"": 2000,
                ""y"": 420,
                ""w"": 48,
                ""h"": 48
            },
            {
                ""x"": 2000,
                ""y"": 468,
                ""w"": 48,
                ""h"": 48
            }
        ],
        ""run"": [
            {
                ""x"": 1920,
                ""y"": 548,
                ""w"": 32,
                ""h"": 48
            },
            {
                ""x"": 1424,
                ""y"": 332,
                ""w"": 32,
                ""h"": 48
            },
            {
                ""x"": 1456,
                ""y"": 332,
                ""w"": 32,
                ""h"": 48
            },
            {
                ""x"": 1488,
                ""y"": 332,
                ""w"": 32,
                ""h"": 48
            },
            {
                ""x"": 1520,
                ""y"": 332,
                ""w"": 32,
                ""h"": 48
            },
            {
                ""x"": 1552,
                ""y"": 348,
                ""w"": 32,
                ""h"": 48
            },
            {
                ""x"": 1584,
                ""y"": 348,
                ""w"": 32,
                ""h"": 48
            },
            {
                ""x"": 1616,
                ""y"": 348,
                ""w"": 32,
                ""h"": 48
            }
        ]
    },
    ""anomaly"": {
        ""run"": [
            {
                ""x"": 1952,
                ""y"": 468,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1872,
                ""y"": 484,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1872,
                ""y"": 516,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1872,
                ""y"": 548,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1952,
                ""y"": 500,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 2000,
                ""y"": 516,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1952,
                ""y"": 532,
                ""w"": 48,
                ""h"": 32
            }
        ]
    },
    ""knight0"": {
        ""run"": [
            {
                ""x"": 2000,
                ""y"": 548,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1952,
                ""y"": 564,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 2000,
                ""y"": 580,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1568,
                ""y"": 316,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1616,
                ""y"": 316,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1664,
                ""y"": 316,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1712,
                ""y"": 316,
                ""w"": 48,
                ""h"": 32
            }
        ]
    },
    ""thief"": {
        ""run"": [
            {
                ""x"": 1088,
                ""y"": 332,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1136,
                ""y"": 332,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1184,
                ""y"": 332,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1232,
                ""y"": 332,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1280,
                ""y"": 332,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1328,
                ""y"": 332,
                ""w"": 48,
                ""h"": 32
            },
            {
                ""x"": 1376,
                ""y"": 332,
                ""w"": 48,
                ""h"": 32
            }
        ]
    }
}
	";

	static string witchJson =
	@"
	{
  ""blue_witch"": {
    ""charge"": [
      {
        ""x"": 0,
        ""y"": 0,
        ""w"": 48,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 48,
        ""w"": 48,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 96,
        ""w"": 48,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 144,
        ""w"": 48,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 192,
        ""w"": 48,
        ""h"": 48
      }
    ],
    ""run"": [
      {
        ""x"": 0,
        ""y"": 240,
        ""w"": 32,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 288,
        ""w"": 32,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 336,
        ""w"": 32,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 384,
        ""w"": 32,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 432,
        ""w"": 32,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 480,
        ""w"": 32,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 528,
        ""w"": 32,
        ""h"": 48
      },
      {
        ""x"": 0,
        ""y"": 576,
        ""w"": 32,
        ""h"": 48
      }
    ]
  }
}
	";
}